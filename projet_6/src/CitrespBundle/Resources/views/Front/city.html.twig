{# src/CitrespBundle/Resources/views/Front/city.html.twig #}

{% extends '@Citresp/layout.html.twig' %}

{% block stylesheets %}
  {{ parent() }}

  <style>

    #map {
      min-height: 26.25rem;

    }
  </style>
{% endblock %}

{% block header %}
  {% embed "@Citresp/cityMapHeader.html.twig" %}{% endembed %}
{% endblock %}

{% block body %}

  <div class="text-center">
    <div class="container reporting-btn bg-light">
      <a href="{{ path('create_reporting', {'slug': app.user.city.slug}) }}" class="btn btn-lg btn-warning ">Faire un signalement</a>
    </div>

    <!-- Liste des signalements -->
    <div class="container reportings-block">
      <div class="">
      {% for reporting in reportings %}
        <h2>Liste des signalements</h2>
        <hr>
        <h4>{{ reporting.address }}</h4>
        <p class="text-muted">
          <strong>{{ reporting.user }}</strong>
          le
          {{ reporting.dateCreated|localizeddate('none', 'none', null, null, 'EEEE d MMMM Y') }}
        </p>
        <h5>{{ reporting.category.name }}</h5>
        <p>{{reporting.id}}</p>
        <p>
          <a class="" href="{{ path('show_reporting',
        {'slug': app.user.city.slug, 'reporting_id': reporting.id}) }}">
            Voir
          </a>
        </p>
      {% else %}
        <h4>Aucun signalement pour l'instant</h4>
      {% endfor %}
      </div>
    </div>
  </div>

{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script>
    var map;
    function initMap() {
      var city = {
        lat: {{ city.gpsLat }},
        lng: {{ city.gpsLng }}
      };
      var jsMarkers = new Array();

      map = new google.maps.Map(document.getElementById('map'), {
        zoom: 15,
        center: city
      });

      {% for reporting in reportings %}

        var marker = new google.maps.Marker({
          position: {
            lat: {{ reporting.gpsLat }},
            lng: {{ reporting.gpsLng }}
          },
          map: map
        });
      {% endfor %}

    }
  </script>
  <script src="https://maps.googleapis.com/maps/api/js?key={{googleApi}}&callback=initMap" async="async" defer="defer"></script>
{% endblock %}
